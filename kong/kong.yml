_format_version: "3.0"
services:
  - name: backend
    url: $KONG_BACKEND_URL
    routes:
      - name: backend-api
        paths:
          - /api
        strip_path: false
      - name: backend-login
        paths:
          - /api/auth/login
        strip_path: false
      - name: backend-health
        paths:
          - /healthz
        strip_path: false
plugins:
  - name: rate-limiting
    service: backend
    config:
      minute: 200
      hour: 2000
      policy: local
      limit_by: ip
  - name: request-size-limiting
    service: backend
    config:
      allowed_payload_size: 1 # MB
      require_content_length: false
  - name: rate-limiting
    route: backend-login
    config:
      minute: 5
      hour: 60
      policy: local
      limit_by: ip
      fault_tolerant: false
consumers:
  - username: local-tester
    keyauth_credentials:
      - key: ${KONG_CONSUMER_KEY}
    acls:
      - group: trusted-clients
